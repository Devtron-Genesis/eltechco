{ "rules_commerce_order_message_order_notification_e_mail" : {
    "LABEL" : "Commerce order message: order notification e-mail",
    "PLUGIN" : "reaction rule",
    "REQUIRES" : [ "rules", "message_notify", "php", "commerce_checkout" ],
    "ON" : [ "commerce_checkout_complete" ],
    "DO" : [
      { "entity_create" : {
          "USING" : {
            "type" : "message",
            "param_type" : "commerce_order_order_confirmation",
            "param_user" : [ "commerce-order:owner" ]
          },
          "PROVIDE" : { "entity_created" : { "entity_created" : "Created entity" } }
        }
      },
      { "data_set" : {
          "data" : [ "entity-created:message-commerce-order" ],
          "value" : [ "commerce-order" ]
        }
      },
      { "entity_save" : { "data" : [ "entity-created" ], "immediate" : 1 } },
      { "message_notify_process" : {
          "message" : [ "entity-created" ],
          "save_on_fail" : 0,
          "save_on_success" : 0
        }
      },
      { "mail" : {
          "to" : "[site:mail]",
          "subject" : "Hello Admin, [commerce-order:mail]  has created an order",
          "message" : "\u003C?php\r\n\r\n$wrapper = entity_metadata_wrapper(\u0027commerce_order\u0027, $commerce_order);\r\n \r\n\r\n$shipping_address = $wrapper-\u003Ecommerce_customer_shipping-\u003Ecommerce_customer_address-\u003Evalue();\r\nprint \u0027\u003Cdiv style=\u0022padding:10px;border:solid 1px #e9e9e9\u0022\u003E\u0027;\r\n\r\nprint \u0027\u003Cp style=\u0022color:#b2b2b2;padding-bottom:15px;font-size:18px\u0022\u003EHere are the details for your order \u003Cspan style=\u0022color:#00a0da\u0022\u003E  [commerce-order:url] \u003C\/span\u003E, placed on   [commerce-order:created]\u003C\/p\u003E\u0027;\r\n\r\n\r\nprint \u0027\u003Cdiv style=\u0022clear:both\u0022\u003E\u0027;\r\n\r\nprint \u0027\u003Cdiv style=\u0022float:left\u0022\u003E\u0027;\r\nprint \u0027\u003Cp style=\u0022font-size:20px;font-weight:bold\u0022\u003EShip to\u003C\/p\u003E\u0027;\r\nprint \u0027\u003Cp\u003E\u0027;\r\nprint \u0027\u003C\/p\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022font-weight:bold;color:#90847c;font-size:17px\u0022\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022font-weight:bold\u0022\u003E\u0027 . $shipping_address[\u0027name_line\u0027] . \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022color:#90847c;font-size:17px\u0022\u003E\u0027;\r\nprint  $shipping_address[\u0027thoroughfare\u0027];\r\nprint \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003Cdiv\u003E\u0027;\r\necho (trim($billing_address[\u0027premise\u0027]) != \u0022\u0022 ? \u0022\\n\u0022.$billing_address[\u0027premise\u0027] : \u0022\u0022);\r\necho \u0022\\n\u0022.$shipping_address[\u0027locality\u0027].\u0022, \u0022.$shipping_address[\u0027administrative_area\u0027].\u0022  \u0022.$shipping_address[\u0027postal_code\u0027];\r\nprint \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022float:right\u0022\u003E\u0026nbsp;\u003C\/div\u003E\u0027;\r\nprint \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022clear:both\u0022\u003E\u0027;\r\nprint \u0027\u003Cp style=\u0022font-size:20px;font-weight:bold\u0022\u003EItems in your order\u003C\/p\u003E\u0027;\r\nprint \u0027\u003Cp\u003E\u0027;\r\nprint \u0027\u003C\/p\u003E\u0027;\r\nprint \u0027\u003Cdiv\u003E\u0027;\r\nprint \u0027\u003Cdiv\u003E\u0027;\r\nprint \u0027\u003Ctable style=\u0022border:none;border-collapse:collapse;width:100%\u0022\u003E\u0027;\r\nprint \u0027\u003Cthead\u003E\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Cth style=\u0022border:none;background:transparent;border-bottom:#aaaaaa solid 1px;text-transform:none;font-weight:bold;text-align:left\u0022\u003E\u0027;\r\nprint \u0027          Product    SKU    \u003C\/th\u003E\u0027;\r\nprint \u0027\u003Cth style=\u0022border:none;background:transparent;border-bottom:#aaaaaa solid 1px;text-transform:none;font-weight:bold;text-align:left\u0022\u003E\u0027;\r\nprint \u0027         Product   Name     \u003C\/th\u003E\u0027;\r\nprint \u0027\u003Cth style=\u0022border:none;background:transparent;border-bottom:#aaaaaa solid 1px;text-transform:none;font-weight:bold;text-align:left\u0022\u003E\u0027;\r\nprint \u0027          Price        \u003C\/th\u003E\u0027;\r\nprint \u0027\u003Cth style=\u0022border:none;background:transparent;border-bottom:#aaaaaa solid 1px;text-transform:none;font-weight:bold;text-align:left\u0022\u003E\u0027;\r\nprint \u0027          Quantity        \u003C\/th\u003E\u0027;\r\nprint \u0027\u003Cth style=\u0022border:none;background:transparent;border-bottom:#aaaaaa solid 1px;text-transform:none;font-weight:bold;text-align:left\u0022\u003E\u0027;\r\nprint \u0027          Total        \u003C\/th\u003E\u0027;\r\nprint \u0027\u003C\/tr\u003E\u003C\/thead\u003E\u0027;\r\nprint \u0027 \u003Ctbody\u003E\u0027;\r\n\r\n\r\n\r\n$line_items =  $wrapper-\u003Ecommerce_line_items-\u003Evalue();\r\n$subtt = 0;\r\nforeach($line_items as $line_item){\r\n \r\n   if($line_item-\u003Etype == \u0027product\u0027){\r\n     $product = commerce_product_load($line_item-\u003Ecommerce_product[\u0027und\u0027][0][\u0027product_id\u0027]);\r\n\r\nprint \u0027\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint   $product-\u003Esku . \u0027\u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint  $product-\u003Etitle . \u0027\u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\n \r\nprint commerce_currency_format($line_item-\u003Ecommerce_unit_price[\u0027und\u0027][\u00270\u0027][\u0027amount\u0027],$line_item-\u003Ecommerce_unit_price[\u0027und\u0027][\u00270\u0027][\u0027currency_code\u0027]) . \u0027 \u003C\/td\u003E\u0027;\r\n \r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint  number_format($line_item-\u003Equantity)  . \u0027 \u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\n \r\nprint commerce_currency_format($line_item-\u003Ecommerce_total[\u0027und\u0027][\u00270\u0027][\u0027amount\u0027],$line_item-\u003Ecommerce_total[\u0027und\u0027][\u00270\u0027][\u0027currency_code\u0027]) . \u0027 \u003C\/td\u003E\u0027; \r\n\r\nprint \u0027\u003C\/tr\u003E\u0027;\r\n\r\n$nb = commerce_currency_amount_to_decimal($line_item-\u003Ecommerce_total[\u0027und\u0027][\u00270\u0027][\u0027amount\u0027],$line_item-\u003Ecommerce_total[\u0027und\u0027][\u00270\u0027][\u0027currency_code\u0027]); \r\n$subtt += $nb;\r\n\r\n   }\r\n}\r\n\r\n\r\nprint \u0027\u003C\/tbody\u003E\u0027;\r\nprint \u0027\u003C\/table\u003E\u0027;\r\nprint \u0027\u003C\/div\u003E\u0027;\r\nprint \u0027\u003Cdiv style=\u0022clear:both; \u0022\u003E\u0027;\r\nprint \u0027\u003Ctable style=\u0022border:none;border-collapse:collapse;width:25%;float:right; background-color: rgb(240, 240, 240); padding:10px;\u0022\u003E\u003Ctbody\u003E\u0027;\r\nprint \u0027\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003ESubtotal\u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003E\u0027 .  number_format($subtt,2)    . \u0027 AUD\u003C\/td\u003E\u0027;\r\nprint \u0027\u003C\/tr\u003E\u0027;\r\nprint \u0027\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003EGST\u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003E\u0027 . number_format($subtt*0.1 ,2) . \u0027  AUD\u003C\/td\u003E\u0027;\r\nprint \u0027\u003C\/tr\u003E\u0027;\r\nprint \u0027\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003EFlat Shipping\u003C\/td\u003E\u0027;\r\n\r\nforeach ($wrapper-\u003Ecommerce_line_items as $delta =\u003E $line_item_wrapper) {\r\nif ($line_item_wrapper-\u003Etype-\u003Evalue() == \u0027shipping\u0027) {\r\n$mnt = $line_item_wrapper-\u003Ecommerce_unit_price-\u003Evalue();\r\n}\r\n}\r\n\r\n\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003E\u0027 .  commerce_currency_format($mnt[amount],commerce_default_currency())  . \u0027  \u003C\/td\u003E\u0027;\r\nprint \u0027\u003C\/tr\u003E\u0027;\r\nprint \u0027\u003Ctr style=\u0022border:none;background:transparent;padding:10px;text-align:left\u0022\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003EOrder total\u003C\/td\u003E\u0027;\r\nprint \u0027\u003Ctd style=\u0022border:none;background:transparent;padding:10px;text-align:right\u0022\u003E[commerce-order:commerce_order_total]\u003C\/td\u003E\u0027;\r\nprint \u0027\u003C\/tr\u003E\u0027;\r\nprint \u0027\u003C\/tbody\u003E\u003C\/table\u003E\u0027; \r\n\r\n\r\nprint \u0027\u003C\/div\u003E\u0027;\r\n\r\n$latest_pay_trans = end(commerce_payment_transaction_load_multiple(array(), array(\u0027order_id\u0027 =\u003E $commerce_order-\u003Eorder_number)));\r\nprint \u0027\u003Cdiv style=\u0022clear:both;\u0022\u003E\u0027.t($latest_pay_trans-\u003Emessage, $latest_pay_trans-\u003Emessage_variables).\u0027\u003C\/div\u003E\u0027;\r\n\r\nprint \u0027\u003C\/div\u003E\u0027;\r\n\r\n?\u003E",
          "language" : [ "commerce-order:state" ]
        }
      }
    ]
  }
}